import React, { useState, useEffect, useMemo } from 'react';
import { BookOpen, CheckCircle, XCircle, Circle, RotateCcw, Trophy, ChevronRight, ChevronLeft, MapPin, Globe, RefreshCw, List, Layers, ArrowLeft, History, Brain } from 'lucide-react';

// --- 教科タイプ ---
type Subject = 'history' | 'ethics';

// --- 歴史データ ---
const historyData = [
  // === 追加箇所：1925年の記述 ===
  { id: 100, category: "ナチスの台頭", question: "1925年に創設された、ヒトラー個人を守る忠実な武装集団、ナチス（　？　）。", answer: "親衛隊(SS)" },
  // === 第1弾データ（ナチス・日中戦争・満州事変） ===
  { id: 101, category: "ナチスの台頭", question: "1929年の世界恐慌後、ナチスと共に議席を伸ばした政党は？", answer: "共産党" },
  { id: 102, category: "ナチスの台頭", question: "ヒトラーはユダヤ人を諸悪の根源とすることで、大衆に不満の掃け口を与えた。「すべての問題の原因は（　？　）」。", answer: "ユダヤ人にあり" },
  { id: 103, category: "ナチスの台頭", question: "共産党の勢力拡大を恐れ、ナチス支持に回った層は？（2つ）", answer: "資本家・地主" },
  { id: 104, category: "ナチスの台頭", question: "強国ドイツの復活と軍拡を目指すナチスを支持した勢力は？", answer: "軍部" },
  { id: 105, category: "ナチスの台頭", question: "ヒトラー内閣が、ライバルの共産党を解散に追い込むために利用した事件は？", answer: "国会議事堂放火事件" },
  { id: 106, category: "ナチスの台頭", question: "ナチスの一党独裁体制を確立した法律は？", answer: "全権委任法" },
  { id: 107, category: "ナチスの台頭", question: "1934年にヒトラーが就任した地位は？", answer: "総統（フューラー）" },
  { id: 108, category: "ナチスの内政", question: "計画経済による経済再建と軍備強化を目指した計画は？", answer: "4か年計画" },
  { id: 109, category: "ナチスの内政", question: "ユダヤ人迫害・差別を法制化した法律は（　？　）法。", answer: "ニュルンベルク" },
  { id: 110, category: "ナチスの内政", question: "反体制派を弾圧した秘密警察の名称は？", answer: "ゲシュタポ" },
  { id: 111, category: "ナチスの内政", question: "遺伝病を持つ人に対する強制断種措置などを定めた法律は？", answer: "断種法" },
  { id: 112, category: "ナチスの内政", question: "「健全な国民」の育成のため、（　？　）という考え方がとられた。", answer: "劣ったものを科学的に選抜して排除" },
  { id: 113, category: "ナチスの内政", question: "宣伝活動に有効活用されたメディアは？", answer: "ラジオ" },
  { id: 114, category: "ナチスの内政", question: "ナチスの青少年組織は？", answer: "ヒトラーユーゲント" },
  { id: 201, category: "ドイツ情勢", question: "第一次世界大戦後に成立したドイツの共和国は？", answer: "ヴェイマル共和国" },
  { id: 202, category: "ドイツ情勢", question: "ドイツ革命後に政権を取った政党は？", answer: "社会民主党" },
  { id: 203, category: "ドイツ情勢", question: "ヴァイマル憲法制定時の大統領は？", answer: "エーベルト" },
  { id: 204, category: "ドイツ情勢", question: "協調外交路線をとり、ロカルノ条約などを締結した外相は？", answer: "シュトレーゼマン" },
  { id: 205, category: "ヒトラーの経歴", question: "ナチスの正式名称は？", answer: "国民社会主義ドイツ労働者党" },
  { id: 206, category: "ヒトラーの経歴", question: "ナチスの私兵集団（SA）の名称は？", answer: "突撃隊" },
  { id: 207, category: "ヒトラーの経歴", question: "1923年、ムッソリーニを真似て武力による政権転覆を企て失敗した事件は？", answer: "ミュンヘン一揆" },
  { id: 208, category: "ヒトラーの経歴", question: "ヒトラーが獄中で執筆した著書は？", answer: "わが闘争" },
  { id: 301, category: "ナチスの内政", question: "スポーツの政治利用として開催されたイベントは？", answer: "ベルリンオリンピック" },
  { id: 302, category: "ナチスの内政", question: "労働者にも提供された自家用車の名称は？", answer: "フォルクスワーゲン" },
  { id: 401, category: "日中戦争前夜", question: "1936年に起きた、皇道派の青年将校によるクーデタ未遂事件は？", answer: "二・二六事件" },
  { id: 402, category: "中国情勢", question: "瑞金を追われた中国共産党が行った大移動を何という？", answer: "長征" },
  { id: 403, category: "中国情勢", question: "長征の末に共産党が拠点を移した場所は？", answer: "延安" },
  { id: 404, category: "中国情勢", question: "1935年、共産党が国民党に対して抗日民族統一戦線を呼びかけた宣言は？", answer: "八・一宣言" },
  { id: 405, category: "中国情勢", question: "1936年、蒋介石が監禁され、共産党との内戦停止を迫られた事件は？", answer: "西安事件" },
  { id: 406, category: "中国情勢", question: "西安事件で蒋介石を監禁した人物は？", answer: "張学良" },
  { id: 407, category: "日中戦争", question: "1937年7月、日中戦争の発端となった事件は？", answer: "盧溝橋事件" },
  { id: 501, category: "満州事変", question: "1932年の五・一五事件で暗殺された首相は？", answer: "犬養毅" },
  { id: 502, category: "満州事変", question: "1932年、日本が満州国を正式承認した際に結んだ条約は？", answer: "日満議定書" },
  { id: 503, category: "満州事変", question: "国際連盟が満州事変の調査のために派遣したのは？", answer: "リットン調査団" },
  { id: 504, category: "満州事変", question: "リットン報告書が求めた、中国側の行動の停止とは？", answer: "対日ボイコット" },
  { id: 505, category: "満州事変", question: "国際連盟脱退時の日本全権は？", answer: "松岡洋右" },
  { id: 601, category: "満州事変", question: "長春・大連間の鉄道を管理していた会社は？", answer: "南満州鉄道株式会社（満鉄）" },
  { id: 602, category: "満州事変", question: "関東州と満鉄の保護のために設置された軍隊は？", answer: "関東軍" },
  { id: 603, category: "満州事変", question: "関東軍が担うようになった、鉄道守備以外の役割は？", answer: "対ソ連戦略" },
  { id: 604, category: "満州事変", question: "日本の経済危機克服などのために中国東北部を日本領とすべきという議論は？", answer: "満蒙領有論" },
  { id: 605, category: "満州事変", question: "1931年9月18日、関東軍が爆破した線路の場所は？", answer: "柳条湖" },
  { id: 606, category: "満州事変", question: "柳条湖事件の犯人とされた軍閥の人物は？", answer: "張学良" },
  { id: 607, category: "満州事変", question: "満州事変当時、不拡大方針をとった立憲民政党の内閣は？", answer: "若槻礼次郎内閣" },
  { id: 608, category: "満州事変", question: "1932年に建国された満州国の執政（のち皇帝）となった人物は？", answer: "溥儀" },
  { id: 609, category: "満州事変", question: "満州国の首都は？", answer: "新京" },
  { id: 610, category: "日本国内", question: "政党や財閥を倒し、軍部独裁などによる国家改造を目指す思想（スローガン）は？", answer: "昭和維新" },
  { id: 701, category: "ヒトラーの拡張", question: "イギリスが当初ドイツの再軍備を認めた理由は、ドイツを（　？　）として利用するため。", answer: "ソ連に対する防壁" },
  { id: 702, category: "ヒトラーの拡張", question: "1936年、ヒトラーがロカルノ条約を破棄して軍を進めた地域は？", answer: "ラインラント（進駐）" },
  { id: 703, category: "ヒトラーの拡張", question: "1938年、ドイツが併合した国は？", answer: "オーストリア" },
  { id: 704, category: "ヒトラーの拡張", question: "1938年、ドイツが割譲を要求したチェコスロヴァキアの地方は？", answer: "ズデーテン地方" },
  { id: 705, category: "ヒトラーの拡張", question: "ズデーテン危機に際し、戦争回避のためにイギリスのチェンバレン首相らがとった政策は？", answer: "宥和政策" },
  { id: 706, category: "ヒトラーの拡張", question: "1938年、ズデーテン問題解決のために開かれた会談は？", answer: "ミュンヘン会談" },
  { id: 707, category: "ヒトラーの拡張", question: "ミュンヘン会談に参加した4カ国はドイツとどこ？", answer: "イギリス・フランス・イタリア" },
  { id: 708, category: "ヒトラーの拡張", question: "ミュンヘン会談の仲介を行ったイタリアの首相は？", answer: "ムッソリーニ" },
  { id: 709, category: "ヒトラーの拡張", question: "ミュンヘン会談に招待されず、英仏との関係が悪化した国は？", answer: "ソ連" },
  { id: 710, category: "ヒトラーの拡張", question: "1939年、ヒトラーがミュンヘン会談の約束を破って行った行動は？", answer: "チェコ占領（スロヴァキア保護国化）" },
  { id: 711, category: "ヒトラーの拡張", question: "1939年、犬猿の仲だった独ソが手を結んだ条約は？", answer: "独ソ不可侵条約" },
  { id: 801, category: "日中戦争", question: "1937年9月、抗日民族統一戦線が成立したことを何という？", answer: "第二次国共合作" },
  { id: 802, category: "日中戦争", question: "日本軍が目指し、占領後に大虐殺が起きたとされる国民政府の首都は？", answer: "南京" },
  { id: 803, category: "日中戦争", question: "南京陥落後、国民政府が首都を移して抵抗を続けた場所は？", answer: "重慶" },
  { id: 804, category: "日中戦争", question: "1938年、近衛文麿内閣が出した声明は？", answer: "東亜新秩序" },
  { id: 805, category: "日中戦争", question: "日本が中国に樹立した親日傀儡政権のトップは？", answer: "汪兆銘" },
  { id: 806, category: "戦時体制", question: "1938年、政府による物資の統制などを定めた法律は？", answer: "国家総動員法" },
  { id: 807, category: "戦時体制", question: "1935年、ヒトラーが行った軍備拡張の宣言は？", answer: "再軍備宣言" },
  { id: 901, category: "第二次世界大戦", question: "第二次世界大戦が始まったのは何年？", answer: "1939年" },
  { id: 902, category: "第二次世界大戦", question: "第二次世界大戦の発端となった、ドイツが侵攻した国は？", answer: "ポーランド" },
  { id: 903, category: "第二次世界大戦", question: "独ソ不可侵条約に基づき、東からポーランドに侵攻した国は？", answer: "ソ連" },
  { id: 904, category: "第二次世界大戦", question: "ソ連が侵攻した、エストニア・ラトビア・リトアニアを総称して何という？", answer: "バルト三国" },
  { id: 905, category: "第二次世界大戦", question: "ソ連が侵攻した北欧の国は？", answer: "フィンランド" },
  { id: 906, category: "第二次世界大戦", question: "1940年、ドイツに降伏したフランスで成立した、南フランスの親独政権は？", answer: "ヴィシー政府" },
  { id: 907, category: "第二次世界大戦", question: "ヴィシー政府の首班となった元帥は？", answer: "ペタン" },
  { id: 908, category: "第二次世界大戦", question: "ロンドンに亡命し、対独徹底抗戦（レジスタンス）を呼びかけたフランスの将軍は？", answer: "ド＝ゴール" },
  { id: 909, category: "第二次世界大戦", question: "フランス降伏後、対独徹底抗戦を主張したイギリス首相は？", answer: "チャーチル" },
  { id: 910, category: "第二次世界大戦", question: "ドイツ空軍によるイギリス本土への激しい空爆戦を何という？", answer: "バトル・オブ・ブリテン" },
  // === 第2弾 データ（独ソ戦・太平洋戦争・終戦） ===
  { id: 1001, category: "独ソ戦", question: "1940年に日本も加わり、（　？　）が締結される。", answer: "日独伊三国同盟" },
  { id: 1002, category: "独ソ戦", question: "イタリア軍の失態＝（　？　）、（　？　）でイタリア軍は攻勢をかけるが反撃にあう。", answer: "リビア、ギリシア" },
  { id: 1003, category: "独ソ戦", question: "独ソが対立したきっかけは、（　？　）の利権を巡るものだった。", answer: "バルカン半島" },
  { id: 1004, category: "独ソ戦", question: "1941年にドイツ軍は（　？　）、（　？　）を占領した。", answer: "ユーゴスラビア、ギリシア" },
  { id: 1005, category: "独ソ戦", question: "1941年6月、ドイツ軍はソ連に奇襲攻撃をかけるが、冬の到来などにより（　？　）占領に失敗。", answer: "モスクワ" },
  { id: 1006, category: "独ソ戦", question: "1941年12月に（　？　）が参戦し、イギリスと協力してソ連に援助物資を送った。", answer: "アメリカ" },
  { id: 1007, category: "独ソ戦", question: "1942年（　？　）条約、米ソ相互援助条約の締結。", answer: "英ソ相互援助" },
  { id: 1008, category: "独ソ戦", question: "1942年「青作戦」でヒトラーはモスクワではなくカフカス地方の油田（　？　）の占領を目指した。", answer: "バクー" },
  { id: 1009, category: "独ソ戦", question: "1942-43年、第2次世界大戦のターニングポイントとなった戦いは（　？　）の戦い。", answer: "スターリングラード" },
  { id: 1101, category: "太平洋戦争", question: "1941年から（　？　）を開始するが、対立が深まる。", answer: "日米交渉" },
  { id: 1102, category: "太平洋戦争", question: "1941年4月に（　？　）を締結する。これがかえってアメリカの不信を買う。", answer: "日ソ中立条約" },
  { id: 1103, category: "太平洋戦争", question: "日本は資源を確保するために、ドイツに降伏したフランスの植民地（　？　）に進駐する。", answer: "仏領インドシナ" },
  { id: 1104, category: "太平洋戦争", question: "1941年8月、アメリカは制裁措置として、日本に対する（　？　）の禁輸処置に踏み切る。", answer: "石油" },
  { id: 1105, category: "太平洋戦争", question: "1941年12月8日、日本軍はハワイの（　？　）を奇襲攻撃し、太平洋戦争が始まった。", answer: "真珠湾" },
  { id: 1106, category: "太平洋戦争", question: "日本が米英と対立した理由の一つは、中国国民党を支援する「（　？　）」の存在だった。", answer: "援蒋ルート" },
  { id: 1107, category: "太平洋戦争", question: "開戦後、日本軍はイギリス領（　？　）、（　？　）を攻略した。", answer: "マレー、シンガポール" },
  { id: 1108, category: "太平洋戦争", question: "日本軍はアメリカ統治下の（　？　）を占領した。", answer: "フィリピン" },
  { id: 1109, category: "太平洋戦争", question: "日本軍はオランダ領（　？　）を占領し、石油・ゴムなどの資源地帯を確保した。", answer: "東インド" },
  { id: 1110, category: "戦時下の日本", question: "1940年に（　？　）という理念が提唱された。", answer: "大東亜共栄圏" },
  { id: 1111, category: "戦時下の日本", question: "「大東亜共栄圏」は、あくまで（　？　（アングロサクソン））からの解放と主張した。", answer: "米英" },
  { id: 1201, category: "太平洋戦争", question: "1942年、日本軍の主力空母4隻を喪失する大敗北となったのは（　？　）海戦。", answer: "ミッドウェー" },
  { id: 1202, category: "太平洋戦争", question: "日本軍はソロモン諸島、（　？　）で連合軍と死闘を繰り広げ、消耗戦の末に撤退した。", answer: "ガダルカナル" },
  { id: 1203, category: "太平洋戦争", question: "ガダルカナル戦などの目的は、アメリカと（　？　）の連絡線切断だった。", answer: "オーストラリア" },
  { id: 1204, category: "太平洋戦争", question: "1944年、（　？　）海戦でベテランパイロットを失い、日本海軍は壊滅した。", answer: "マリアナ沖" },
  { id: 1301, category: "欧州戦線の終結", question: "1941年、（　？　）で米・英が枢軸国との対決を決定。", answer: "大西洋憲章" },
  { id: 1302, category: "欧州戦線の終結", question: "大西洋憲章と同時に（　？　）も決定された。", answer: "対ソ援助" },
  { id: 1303, category: "欧州戦線の終結", question: "1943年、枢軸国の中で最初に脱落（降伏）したのは（　？　）。", answer: "イタリア" },
  { id: 1304, category: "欧州戦線の終結", question: "1944年、連合軍による（　？　）上陸作戦（史上最大の作戦）が行われた。", answer: "ノルマンディー" },
  { id: 1305, category: "欧州戦線の終結", question: "1945年2月、米英ソ首脳による（　？　）会談がソ連で開催された。", answer: "ヤルタ" },
  { id: 1306, category: "欧州戦線の終結", question: "ヤルタ会談で、（　？　・千島列島）のソ連帰属を条件とする対日参戦が決定された。", answer: "南樺太" },
  { id: 1401, category: "敗戦への道", question: "1944年、（　？　）の喪失により、日本本土への空爆拠点が作られた。", answer: "サイパン島" },
  { id: 1402, category: "敗戦への道", question: "アメリカ軍による（　？　）作戦で、日本の海上輸送ルートは壊滅状態になった。", answer: "通商破壊" },
  { id: 1403, category: "敗戦への道", question: "1945年、（　？　）の戦いでは、栗林忠道のもとで日本軍が粘り強い抵抗を行った。", answer: "硫黄島" },
  { id: 1404, category: "敗戦への道", question: "1945年、日本本土で唯一の地上戦となったのは（　？　）。", answer: "沖縄戦" },
  { id: 1405, category: "敗戦への道", question: "1945年春に（　？　）などの無差別爆撃が行われた。", answer: "東京大空襲" },
  { id: 1406, category: "敗戦への道", question: "1945年8月、広島・長崎に（　？　）が投下される。", answer: "原爆" },
  { id: 1407, category: "敗戦への道", question: "1945年、（　？　）会談で日本の無条件降伏が要求された。", answer: "ポツダム会談" },
  { id: 1408, category: "敗戦への道", question: "ポツダム会談時、アメリカ大統領は（　？　）に代わっていた。", answer: "トルーマン" },
  { id: 1409, category: "敗戦への道", question: "1945年8月、日ソ中立条約を無視して（　？　）が参戦した。", answer: "ソ連" },
  { id: 1501, category: "戦争の被害・戦後", question: "ナチスはユダヤ人らを（　？　）をはじめとする強制収容所で虐殺した。", answer: "アウシュヴィッツ" },
  { id: 1502, category: "戦争の被害・戦後", question: "アジアの労働者や捕虜を強制労働させて建設された鉄道は（　？　）鉄道。", answer: "泰緬（たいめん）" },
  // === 第3弾データ（地図問題・冷戦・現代史） ===
  // 太平洋戦争（地図）
  { id: 1601, category: "太平洋戦争（地図・まとめ）", question: "1941年12月8日、日本軍が奇襲攻撃を行ったハワイの場所（地図a）は？", answer: "真珠湾" },
  { id: 1602, category: "太平洋戦争（地図・まとめ）", question: "1942年、日本軍が主力空母4隻を喪失した海戦の場所（地図b）は？", answer: "ミッドウェー" },
  { id: 1603, category: "太平洋戦争（地図・まとめ）", question: "1942-43年、日本軍がアメリカ軍と死闘を繰り広げ、撤退した場所（地図c）は？", answer: "ガダルカナル" },
  { id: 1604, category: "太平洋戦争（地図・まとめ）", question: "1944年に陥落し、日本本土空襲の拠点となった場所（地図d）は？", answer: "サイパン（島）" },
  { id: 1605, category: "太平洋戦争（地図・まとめ）", question: "1945年の激戦地で、星条旗を掲げる写真でも有名な場所（地図e）は？", answer: "硫黄島" },
  { id: 1606, category: "太平洋戦争（地図・まとめ）", question: "1945年、多くの民間人が巻き込まれる地上戦が行われた場所（地図f）は？", answer: "沖縄" },
  { id: 1607, category: "太平洋戦争（地図・まとめ）", question: "日本軍が進駐したフランスの植民地（植民地A）の名称は？", answer: "仏領インドシナ" },
  { id: 1608, category: "太平洋戦争（地図・まとめ）", question: "日本軍が資源確保のために占領したオランダの植民地（植民地B）の名称は？", answer: "オランダ領東インド" },
  { id: 1609, category: "太平洋戦争（地図・まとめ）", question: "日米開戦時の日本の首相の名前は？", answer: "東条英機" },
  { id: 1610, category: "太平洋戦争（地図・まとめ）", question: "1944年にサイパン近辺で行われ、日本の惨敗に終わった海戦名は？", answer: "マリアナ沖海戦" },
  { id: 1611, category: "太平洋戦争（地図・まとめ）", question: "ソ連の対日参戦の対価として、ソ連に帰属することになった地域（二つ）は？", answer: "南樺太、千島列島" },
  // 冷戦の終結
  { id: 1701, category: "冷戦の終結", question: "情報公開を進める契機となった、ソ連での原発事故の名称は？", answer: "チェルノブイリ原発事故" },
  { id: 1702, category: "冷戦の終結", question: "1989年、冷戦終結宣言が出された会談の名前は？", answer: "マルタ会談" },
  { id: 1703, category: "冷戦の終結", question: "ソ連のゴルバチョフが掲げた改革路線、「建て直し」をロシア語でなんと呼ぶか？", answer: "ペレストロイカ" },
  { id: 1704, category: "冷戦の終結", question: "ソ連のゴルバチョフが掲げた改革路線、「情報公開」をロシア語でなんと呼ぶか？", answer: "グラスノスチ" },
  // 戦後の欧州・アメリカ
  { id: 1801, category: "戦後の欧州", question: "1975年第一回先進国首脳会議（G7サミット）に参加した国をすべて答えよ。", answer: "米、英、仏、カナダ、西ドイツ、伊、日本" },
  { id: 1802, category: "戦後の欧州", question: "EC（欧州共同体）からEU（欧州連合）への改組を実現した条約の名前は？", answer: "マーストリヒト条約" },
  { id: 1803, category: "戦後の欧州", question: "EU圏内の人の移動の自由化を実現した協定の名前は？", answer: "シェンゲン協定" },
  { id: 1804, category: "戦後の欧州", question: "EU本部がある国と都市の名前は？", answer: "ベルギー・ブリュッセル" },
  { id: 1805, category: "戦後のアメリカ", question: "公民権運動の指導者で、ノーベル平和賞を受賞した黒人の牧師は？", answer: "キング牧師" },
  { id: 1806, category: "戦後のアメリカ", question: "アメリカを建国したとされる人々（ホワイト・アングロサクソン・プロテスタント）の略称は？", answer: "WASP（ワスプ）" },
  { id: 1807, category: "戦後のアメリカ", question: "1970年代以降急増し、黒人を抜いて2位になったヒスパニック系の人種集団の名称は？", answer: "ラティーノ" },
  { id: 1808, category: "戦後のアメリカ", question: "2008年にアメリカから始まり、世界を巻き込んだ金融危機をもたらした事件は？", answer: "リーマン＝ショック" },
  { id: 1809, category: "戦後のアメリカ", question: "2009年に当選した、アメリカ初の黒人大統領の名前は？", answer: "オバマ" },
  { id: 1810, category: "戦後のアメリカ", question: "トランプ大統領（第45代）が所属する政党の名前は？", answer: "共和党" },
  { id: 1811, category: "戦後のアメリカ", question: "バイデン大統領（第46代）が所属する政党の名前は？", answer: "民主党" },
  // 戦後の日本
  { id: 1901, category: "戦後の日本", question: "1951年、日本が主権を回復した条約の名前は？", answer: "サンフランシスコ平和条約" },
  { id: 1902, category: "戦後の日本", question: "「所得倍増」をスローガンとして、経済成長政策を進めた首相の名前は？", answer: "池田勇人" },
  { id: 1903, category: "戦後の日本", question: "1970年に成立した、沖縄の日本復帰を定めた協定の名前は？", answer: "沖縄返還協定" },
  { id: 1904, category: "戦後の日本", question: "ヒトとモノの地方分散への移行を狙った「列島改造」構想を掲げた首相は？", answer: "田中角栄" },
];

// --- 倫理データ ---
const ethicsData = [
  { id: 1, category: "人間とは", question: "人間は生物として、何という微細な粒子から構成されているか。", answer: "原子" },
  { id: 2, category: "人間とは", question: "人間は生物として、固有の遺伝情報を持つ何を持っているか。", answer: "DNA" },
  { id: 3, category: "人間とは", question: "人間は動物分類学上、霊長類の何科に属しているか。", answer: "ヒト科" },
  { id: 4, category: "人間とは", question: "人間は他の動物との差異として、特にどの部位が発達しているか。", answer: "大脳" },
  { id: 5, category: "人間とは", question: "人間特有の、両足を使って立つ移動方法を何というか。", answer: "直立二足歩行" },
  { id: 6, category: "人間とは", question: "人間の特質を知性（理性）にあると捉え、「知恵のある人」という意味で何と呼ぶか。", answer: "ホモ・サピエンス" },
  { id: 7, category: "人間とは", question: "人間を「ホモ・サピエンス」と命名したスウェーデンの生物学者は誰か。", answer: "リンネ" },
  { id: 8, category: "人間とは", question: "人間は自然に働きかけ、環境を作り変えるために何を作ってきたか。", answer: "道具" },
  { id: 9, category: "人間とは", question: "道具を作る人という意味で、人間を「工作人」として何と呼ぶか。", answer: "ホモ・ファーベル" },
  { id: 10, category: "人間とは", question: "「ホモ・ファーベル（工作人）」という人間観を提唱したフランスの哲学者は誰か。", answer: "ベルクソン" },
  { id: 11, category: "人間とは", question: "人間が生活の必要から離れて自由に行う、文化形成の基礎となる活動は何か。", answer: "遊び" },
  { id: 12, category: "人間とは", question: "遊ぶ人という意味で、人間を何と呼ぶか。", answer: "ホモ・ルーデンス" },
  { id: 13, category: "人間とは", question: "「ホモ・ルーデンス（遊ぶ人）」という人間観を提唱したオランダの歴史家は誰か。", answer: "ホイジンガ" },
  { id: 14, category: "人間とは", question: "人間は超越的な神を求めて宗教を生み出すことから、「宗教人」として何と呼ばれるか。", answer: "ホモ・レリギオース" },
  { id: 15, category: "人間とは", question: "「ホモ・レリギオース（宗教人）」という人間観を提唱した宗教学者は誰か。", answer: "エリアーデ" },
  { id: 16, category: "人間とは", question: "人間が持つ、創造的でありながら破壊的でもあるというような相反する性質を何というか。", answer: "二面性" },
  { id: 17, category: "古代ギリシア", question: "世界の出来事が神々の超自然的な働きによるとする考え方を何というか。", answer: "神話的世界観" },
  { id: 18, category: "古代ギリシア", question: "世界の成り立ちを神々や英雄の行為によって説明する物語を何というか。", answer: "神話" },
  { id: 19, category: "古代ギリシア", question: "『イリアス』『オデュッセイア』を著した古代ギリシアの叙事詩人は誰か。", answer: "ホメロス" },
  { id: 20, category: "古代ギリシア", question: "『神統記』を著した古代ギリシアの叙事詩人は誰か。", answer: "ヘシオドス" },
  { id: 21, category: "古代ギリシア", question: "世界の成り立ちを神話ではなく、ロゴスによって捉えようとする考え方を何というか。", answer: "合理的世界観" },
  { id: 22, category: "古代ギリシア", question: "合理的思考、ロゴスによって世界を捉えようとする態度から、何という学問が誕生したか。", answer: "哲学" },
  { id: 23, category: "古代ギリシア", question: "古代ギリシアの自然哲学が探求しようとした「万物の根源」をギリシア語で何というか。", answer: "アルケー" },
  { id: 24, category: "古代ギリシア", question: "「哲学の祖」と呼ばれるイオニアのミレトス出身の自然哲学者は誰か。", answer: "タレス" },
  { id: 25, category: "古代ギリシア", question: "タレスは万物の根源を何であると説いたか。", answer: "水" },
  { id: 26, category: "古代ギリシア", question: "三平方の定理で知られ、サモス島出身の自然哲学者は誰か。", answer: "ピタゴラス" },
  { id: 27, category: "古代ギリシア", question: "ピタゴラスは万物の根源を何であると説いたか。", answer: "数" },
  { id: 28, category: "古代ギリシア", question: "「万物は流転する」と説いたエフェソス出身の自然哲学者は誰か。", answer: "ヘラクレイトス" },
  { id: 29, category: "古代ギリシア", question: "ヘラクレイトスは万物のありようについて、有名な言葉で何と説いたか。", answer: "万物は流転する" },
  { id: 30, category: "古代ギリシア", question: "ヘラクレイトスはこの世界を「永遠に生きる何」であると表現したか。", answer: "火" },
  { id: 31, category: "古代ギリシア", question: "土・水・火・空気の四元素説を唱えた自然哲学者は誰か。", answer: "エンペドクレス" },
  { id: 32, category: "古代ギリシア", question: "アブデラ出身で、原子論を唱えた自然哲学者は誰か。", answer: "デモクリトス" },
  { id: 33, category: "古代ギリシア", question: "デモクリトスは万物の根源を「原子」とした。この理論を何というか。", answer: "原子論" },
  { id: 34, category: "プラトン", question: "プラトンがアテネ郊外に創設した学園を何というか。", answer: "アカデメイア" },
  { id: 35, category: "プラトン", question: "プラトンが理想とした、哲学者が統治を行う政治体制を何というか。", answer: "哲人政治" },
  { id: 36, category: "プラトン", question: "物事の理想としての姿を真の実在とみなす、プラトンの哲学的立場を何というか。", answer: "イデア論" },
  { id: 37, category: "プラトン", question: "プラトンにおいて、究極で最高のイデアとされるものは何か。", answer: "善のイデア" },
  { id: 38, category: "プラトン", question: "真の実在としてのイデアを恋い慕う、人間の魂の情熱を何というか。", answer: "エロース" },
  { id: 39, category: "プラトン", question: "学ぶこととは、魂がかつて見ていたイデアを想い起こすことであるという説を何というか。", answer: "想起説（アナムネーシス）" },
  { id: 40, category: "プラトン", question: "プラトンの魂の三分説において、指導的な役割を果たす魂の部分は何か。", answer: "理性" },
  { id: 41, category: "プラトン", question: "プラトンの四元徳のうち、気概の部分に対応する徳は何か。", answer: "勇気" },
  { id: 42, category: "アリストテレス", question: "アリストテレスが創設した学園を何というか。", answer: "リュケイオン" },
  { id: 43, category: "アリストテレス", question: "アリストテレスの主著の一つで、存在の根本原理を探求した書物の名前は何か。", answer: "形而上学" },
  { id: 44, category: "アリストテレス", question: "アリストテレス哲学において、事物に内在する本質的特徴を何というか。", answer: "形相（エイドス）" },
  { id: 45, category: "アリストテレス", question: "アリストテレス哲学において、形相を実現するための素材となるものを何というか。", answer: "質料（ヒュレー）" },
  { id: 46, category: "アリストテレス", question: "質料が形相を実現する可能性を秘めている状態を何というか。", answer: "可能態（デュナミス）" },
  { id: 47, category: "アリストテレス", question: "質料が形相を実現し、具体的な姿を現した状態を何というか。", answer: "現実態（エネルゲイア）" },
  { id: 48, category: "アリストテレス", question: "アリストテレスが理想とした、理性によって真理を直観する生活を何というか。", answer: "観想（テオリア）的生活" },
  { id: 49, category: "アリストテレス", question: "過不足を避け、その中間を選ぶというアリストテレスの徳の原理を何というか。", answer: "中庸（メソテース）" },
  { id: 50, category: "アリストテレス", question: "アリストテレスが説いた、人と人との間で互いに抱く親愛の情を何というか。", answer: "友愛（フィリア）" },
  { id: 51, category: "ソフィスト・ソクラテス", question: "古代ギリシアで、報酬を受け取って教養や弁論術を教えた職業的教師たちを何というか。", answer: "ソフィスト" },
  { id: 52, category: "ソフィスト・ソクラテス", question: "ソフィストのプロタゴラスが「万物の尺度」であると説いたものは何か。", answer: "人間" },
  { id: 53, category: "ソフィスト・ソクラテス", question: "ソフィストたちが教えた、人を説得するための技術を何というか。", answer: "弁論術" },
  { id: 54, category: "ソフィスト・ソクラテス", question: "真理は人によって異なるとする、ソフィストたちの考え方を何というか。", answer: "相対主義" },
  { id: 55, category: "ソフィスト・ソクラテス", question: "ソクラテスが自覚していた、自分は大切なことについて何も知らないという知を何というか。", answer: "無知の知" },
  { id: 56, category: "ソフィスト・ソクラテス", question: "ソクラテスが用いた対話による探求方法を何というか。", answer: "問答法" },
  { id: 57, category: "ソフィスト・ソクラテス", question: "ソクラテスの問答法は、相手から真理を引き出すことから別名何と呼ばれるか。", answer: "助産術" },
  { id: 58, category: "ソフィスト・ソクラテス", question: "ソクラテスが用いた、無知を装って相手に気づきを与える手法（エイロネイア）を何というか。", answer: "反語" },
  { id: 59, category: "ソフィスト・ソクラテス", question: "ソクラテスが重視したデルフォイの神託の言葉は何か。", answer: "汝自身を知れ" },
  { id: 60, category: "ソフィスト・ソクラテス", question: "ソクラテスが説いた、自分自身の魂が優れたものになるよう配慮することを何というか。", answer: "魂（プシュケー）への配慮" },
  { id: 61, category: "ソフィスト・ソクラテス", question: "真に知っていることと行うことは一致するという、ソクラテスの思想を何というか。", answer: "知行合一" },
  { id: 62, category: "ソフィスト・ソクラテス", question: "徳について知れば徳のある人になれるという、ソクラテスの思想を何というか。", answer: "知徳合一" },
  { id: 63, category: "ソフィスト・ソクラテス", question: "ソクラテスが死に際して説いた、単に生きるのではなく、どう生きることが大切か。", answer: "よく生きること" },
  { id: 64, category: "ユダヤ教", question: "ユダヤ教が信仰する唯一神の名は何か。", answer: "ヤハウェ" },
  { id: 65, category: "ユダヤ教", question: "ユダヤ教のように、特定の民族のみが救われるとする宗教形態を何というか。", answer: "民族宗教" },
  { id: 66, category: "ユダヤ教", question: "ユダヤ教の聖典は何と呼ばれるか。", answer: "旧約聖書" },
  { id: 67, category: "ユダヤ教", question: "ユダヤ教における神の教えや戒律のことを何というか。", answer: "律法（トーラー）" },
  { id: 68, category: "ユダヤ教", question: "古代イスラエルの指導者モーセが神から授かった十カ条の戒めを何というか。", answer: "モーセの十戒" },
  { id: 69, category: "ユダヤ教", question: "神から選ばれ、神の言葉を人々に伝える役割を持つ者を何というか。", answer: "預言者" },
  { id: 70, category: "ユダヤ教", question: "ユダヤ王国が滅ぼされ、人々がバビロニアへ連れ去られた歴史的事件を何というか。", answer: "バビロン捕囚" },
  { id: 71, category: "ユダヤ教", question: "イスラエル民族を救済し、神の国をもたらす者を何と呼ぶか。", answer: "救世主（メシア）" },
  { id: 72, category: "ユダヤ教", question: "律法を厳格に守ることによってのみ救われるとする立場を何というか。", answer: "律法主義" },
  { id: 73, category: "ユダヤ教", question: "律法の文字通りの遵守を重んじた、ユダヤ教の厳格な派閥を何というか。", answer: "パリサイ派" },
  { id: 74, category: "キリスト教", question: "イエスは、神の本質は何であると説いたか。", answer: "愛（神の愛）" },
  { id: 75, category: "キリスト教", question: "神がすべての人に注ぐ無償の愛をギリシア語で何というか。", answer: "アガペー" },
  { id: 76, category: "キリスト教", question: "イエスの第一の戒めは、心を尽くして「誰」を愛せよというものか。", answer: "神への愛" },
  { id: 77, category: "キリスト教", question: "イエスの第二の戒めは、自分を愛するように「誰」を愛せよというものか。", answer: "隣人への愛" },
  { id: 78, category: "キリスト教", question: "イエスの言行や使徒の手紙などが記されたキリスト教の聖典を何というか。", answer: "新約聖書" },
  { id: 79, category: "キリスト教", question: "「救世主」を意味する言葉で、イエスに対する信仰告白として用いられる称号は何か。", answer: "キリスト" },
  { id: 80, category: "キリスト教", question: "イエスが死後3日目に蘇り、弟子の前に現れた出来事を何というか。", answer: "復活" },
  { id: 81, category: "キリスト教", question: "イエスが人間の罪を背負って身代わりに死に、罪を償ったことを何というか。", answer: "贖罪" },
  { id: 82, category: "キリスト教", question: "パウロは、人が義とされるのは律法ではなく「信仰のみ」によると説いた。この教義を何というか。", answer: "信仰義認" },
  { id: 83, category: "キリスト教", question: "キリスト教の三元徳を答えよ。", answer: "信仰・希望・愛" },
  { id: 84, category: "キリスト教", question: "キリスト教における信仰者の共同体を何というか。", answer: "教会（エクレシア）" },
  { id: 85, category: "イスラーム教", question: "イスラーム教を開いた預言者は誰か。", answer: "ムハンマド" },
  { id: 86, category: "イスラーム教", question: "イスラーム教が信仰する唯一絶対の神の名は何か。", answer: "アッラー" },
  { id: 87, category: "イスラーム教", question: "ムハンマドに下された神の啓示を記したイスラーム教の聖典は何か。", answer: "クルアーン（コーラン）" },
  { id: 88, category: "イスラーム教", question: "イスラーム教において、「神に帰依する者（信者）」を何と呼ぶか。", answer: "ムスリム" },
  { id: 89, category: "イスラーム教", question: "ムスリムが信じるべき六つの項目を総称して何というか。", answer: "六信" },
  { id: 90, category: "イスラーム教", question: "ムスリムが実践すべき五つの義務を総称して何というか。", answer: "五行" },
  { id: 91, category: "イスラーム教", question: "五行の一つで、唯一神と預言者への信仰を言葉で表すことを何というか。", answer: "信仰告白（シャハーダ）" },
  { id: 92, category: "イスラーム教", question: "五行の一つで、一日五回メッカの方角へ祈ることを何というか。", answer: "礼拝（サラート）" },
  { id: 93, category: "イスラーム教", question: "五行の一つで、貧しい人々への施し（浄財）を何というか。", answer: "喜捨（ザカート）" },
  { id: 94, category: "イスラーム教", question: "五行の一つで、ラマダン月に飲食を絶つことを何というか。", answer: "断食（サウム）" },
  { id: 95, category: "イスラーム教", question: "五行の一つで、聖地メッカへ赴くことを何というか。", answer: "巡礼（ハッジ）" },
  { id: 96, category: "イスラーム教", question: "イスラームにおいて、神の道のための努力や戦いを何というか。", answer: "聖戦（ジハード）" },
  { id: 97, category: "イスラーム教", question: "イスラーム教徒による信仰の共同体を何と呼ぶか。", answer: "ウンマ" },
  { id: 98, category: "インド思想", question: "古代インド社会における厳格な身分制度を何というか。", answer: "カースト制度" },
  { id: 99, category: "インド思想", question: "古代アーリア人が信仰した、祭式中心の民族宗教を何というか。", answer: "バラモン教" },
  { id: 100, category: "インド思想", question: "バラモン教の根本聖典を何というか。", answer: "ヴェーダ" },
  { id: 101, category: "インド思想", question: "祭式よりも内面的な哲学的思索を重視したバラモン教の聖典（奥義書）を何というか。", answer: "ウパニシャッド" },
  { id: 102, category: "インド思想", question: "人間の行為がその後の運命を決定するという法則を何というか。", answer: "業（カルマ）" },
  { id: 103, category: "インド思想", question: "霊魂が生まれ変わりを繰り返すことを何というか。", answer: "輪廻（サンサーラ）" },
  { id: 104, category: "インド思想", question: "輪廻の苦しみから解放され、永遠の安らぎを得ることを何というか。", answer: "解脱" },
  { id: 105, category: "インド思想", question: "ウパニシャッド哲学における宇宙の根本原理を何というか。", answer: "ブラフマン（梵）" },
  { id: 106, category: "インド思想", question: "ウパニシャッド哲学における個人の本質的自己を何というか。", answer: "アートマン（我）" },
  { id: 107, category: "インド思想", question: "宇宙の根本原理（梵）と個人の自己（我）が一体であるという境地を何というか。", answer: "梵我一如" },
  { id: 108, category: "仏教", question: "仏教を開いた人物（釈迦）の名前は何か。", answer: "ゴータマ＝シッダールタ" },
  { id: 109, category: "仏教", question: "「人生は思い通りにならない苦しみである」という仏教の真理を何というか。", answer: "一切皆苦" },
  { id: 110, category: "仏教", question: "「全てのものは移ろいゆく」という仏教の真理を何というか。", answer: "諸行無常" },
  { id: 111, category: "仏教", question: "「すべてのものに固定的な実体はない」という仏教の真理を何というか。", answer: "諸法無我" },
  { id: 112, category: "仏教", question: "煩悩が消え、苦しみのなくなった悟りの境地を何というか。", answer: "涅槃寂静" },
  { id: 113, category: "仏教", question: "ブッダが悟った真理・法則のことをサンスクリット語で何というか。", answer: "ダルマ（法）" },
  { id: 114, category: "仏教", question: "全てのものは原因と条件によって支え合って存在するという法則を何というか。", answer: "縁起の法" },
  { id: 115, category: "仏教", question: "ブッダが説いた四つの普遍的な真理を総称して何というか。", answer: "四諦" },
  { id: 116, category: "仏教", question: "四諦の一つで、「人生は苦である」という真理を何というか。", answer: "苦諦" },
  { id: 117, category: "仏教", question: "四諦の一つで、「苦の原因は煩悩（執着）である」という真理を何というか。", answer: "集諦" },
  { id: 118, category: "仏教", question: "四諦の一つで、「煩悩を滅した境地（涅槃）がある」という真理を何というか。", answer: "滅諦" },
  { id: 119, category: "仏教", question: "四諦の一つで、「涅槃に至るための正しい道がある」という真理を何というか。", answer: "道諦" },
  { id: 120, category: "仏教", question: "涅槃に至るための具体的な八つの実践徳目を何というか。", answer: "八正道" },
  { id: 121, category: "仏教", question: "快楽と苦行の両極端を避け、正しい知恵と努力を重視する道を何というか。", answer: "中道" },
  { id: 122, category: "仏教", question: "煩悩の炎が吹き消された状態を意味する、仏教の最終的な悟りの境地は何か。", answer: "涅槃（ニルヴァーナ）" },
  { id: 123, category: "仏教", question: "生きとし生けるものへの深い愛や憐れみの心を、仏教では何というか。", answer: "慈悲" },
  { id: 124, category: "仏教", question: "自らの救済だけでなく、他者の救済（利他）を重視する仏教を何というか。", answer: "大乗仏教" },
  { id: 125, category: "仏教", question: "出家して自らの修行と悟りの完成を目指した仏教（保守的な部派）を何と呼ぶか。", answer: "上座部仏教" },
  { id: 126, category: "仏教", question: "大乗仏教の「大乗」とは、どういう意味か。", answer: "大きな乗り物（マハーヤーナ）" },
  { id: 127, category: "仏教", question: "大乗仏教において、悟りを求めつつ他者の救済に努める理想的な人間像を何というか。", answer: "菩薩" },
  { id: 128, category: "仏教", question: "大乗仏教の「空」の思想を理論化したインドの僧は誰か。", answer: "ナーガールジュナ（竜樹）" },
  { id: 129, category: "仏教", question: "すべての事物には固定的な実体がないとする大乗仏教の根本思想を何というか。", answer: "空の思想" },
  { id: 130, category: "仏教", question: "唯識思想を大成したインドの僧で、無着の弟にあたる人物は誰か。", answer: "ヴァスバンドゥ（世親）" },
  { id: 131, category: "仏教", question: "世界はただ心の表れにすぎないとする大乗仏教の思想を何というか。", answer: "唯識思想" },
  { id: 132, category: "日本仏教", question: "聖徳太子の言葉とされる「世間は虚しく、仏のみが真実である」という意味の語句を答えよ。", answer: "世間虚仮、唯仏是真" },
  { id: 133, category: "日本仏教", question: "聖徳太子が制定した『十七条憲法』第一条で重視された精神は何か。", answer: "和の精神" },
  { id: 134, category: "日本仏教", question: "仏教の力によって国家の安泰を図ろうとする思想を何というか。", answer: "鎮護国家" },
  { id: 135, category: "日本仏教", question: "平安時代の貴族たちが求めた、この世で神仏から得られる利益を何というか。", answer: "現世利益" },
  { id: 136, category: "日本仏教", question: "最澄が比叡山延暦寺を拠点として開いた宗派は何か。", answer: "天台宗" },
  { id: 137, category: "日本仏教", question: "すべての人間に生まれながらに備わっている、仏となる可能性を何というか。", answer: "仏性" },
  { id: 138, category: "日本仏教", question: "空海が高野山金剛峯寺を拠点として開いた宗派は何か。", answer: "真言宗" },
  { id: 139, category: "日本仏教", question: "真言宗のように、奥深い秘密の教えを師から弟子へ伝える仏教を何というか。", answer: "密教" },
  { id: 140, category: "日本仏教", question: "三密の行により、この身のままで仏になることを何というか。", answer: "即身成仏" },
  { id: 141, category: "日本仏教", question: "日本古来の神と外来の仏教を結びつけて考える思想を何というか。", answer: "神仏習合" },
  { id: 142, category: "日本仏教", question: "釈迦の死後、時代とともに仏法が衰えるとする歴史観を何というか。", answer: "末法思想" },
  { id: 143, category: "日本仏教", question: "阿弥陀仏の力にすがって極楽浄土へ往生することを願う信仰を何というか。", answer: "浄土信仰" },
  { id: 144, category: "日本仏教", question: "法然が説いた、ひたすら「南無阿弥陀仏」と唱える行を何というか。", answer: "専修念仏" },
  { id: 145, category: "日本仏教", question: "親鸞が説いた、自らの罪を自覚した悪人こそが阿弥陀仏の救済対象であるという説を何というか。", answer: "悪人正機説" },
  { id: 146, category: "日本仏教", question: "禅宗において、悟りを開くために行う座ってする修行を何というか。", answer: "坐禅" },
  { id: 147, category: "日本仏教", question: "道元が説いた、余計な計らいを捨ててただひたすら坐禅することを何というか。", answer: "只管打坐" },
  { id: 148, category: "日本仏教", question: "道元が説いた、坐禅によって心身の執着が抜け落ちた悟りの境地を何というか。", answer: "身心脱落" },
  { id: 149, category: "日本仏教", question: "日蓮宗において唱える「南無妙法蓮華経」という言葉を何というか。", answer: "題目" },
  { id: 150, category: "日本仏教", question: "仏が本体であり、神は民衆を救うために仮の姿で現れたとする説を何というか。", answer: "本地垂迹説" },
  { id: 151, category: "中国思想", question: "荀子が説いた、人間の本性は悪であるという説を何というか。", answer: "性悪説" },
  { id: 152, category: "中国思想", question: "荀子が主張した、人為的な外的規範である礼によって政治を行う考え方を何というか。", answer: "礼治主義" },
  { id: 153, category: "中国思想", question: "老子が説いた、本来の道は万物をありのままに生み育てる無為自然の道であり、その道が廃れたために仁義の道徳を説く孔孟の教えが現れたという批判の言葉は何か。", answer: "大道廃れて仁義あり" },
  { id: 154, category: "中国思想", question: "老子が説いた、万物を生み出す根源を何というか。", answer: "道（タオ）" },
  { id: 155, category: "中国思想", question: "老子が説いた、何事にも作為をろうせず、万物をおのずからそうなるように生み育てる道の働きを指す言葉は何か。", answer: "無為自然" },
  { id: 156, category: "中国思想", question: "老子が説いた、無為自然の生き方の理想的な例えとして挙げた言葉は何か。", answer: "上善は水の如し" },
  { id: 157, category: "中国思想", question: "老子が説いた、柔和で弱々しそうで、人と争わない謙虚な態度のことを何というか。", answer: "柔弱謙下" },
  { id: 158, category: "中国思想", question: "老子の説いた理想社会で、素朴で柔弱な心を持つ人々の住む小国を何というか。", answer: "小国寡民" },
  { id: 159, category: "中国思想", question: "荘子が説いた、人間の世界では人為的に大小・是非・善悪などを区別しているが、自然の世界では対立差別がなく全て同一であるという考えを何というか。", answer: "万物斉同" },
  { id: 160, category: "中国思想", question: "荘子が説いた、心から分別の働きを除いて、心を１つにして虚無にし、自己の心身を忘れ去って無為自然の道と一体となる修養法を何というか。", answer: "心斎坐忘" },
  { id: 161, category: "中国思想", question: "荘子が説いた、一切の欲望や分別から自由となり、虚心になって天地自然と一体となる境地に遊び、与えられた寿命を全うする理想の人間像を何というか。", answer: "真人" },
  { id: 162, category: "中国思想", question: "荘子が説いた、あるがままの自然に身を委ね、万物の生成変化に応じて自由の境地に遊ぶことを何というか。", answer: "逍遥遊" },
  { id: 163, category: "朱子学・陽明学", question: "朱子学の理論で、万物を貫く宇宙の原理（理）と万物の物質的な素材（気）によって万物の成り立ちを説明する理論を何というか。", answer: "理気二元論" },
  { id: 164, category: "朱子学・陽明学", question: "朱子学における、人間の心の本性（性）は、天が授けた理法（理）であるという考えを何というか。", answer: "性即理" },
  { id: 165, category: "朱子学・陽明学", question: "朱子学における修養の方法で、一つ一つの物の理を極めていくことによって、万物を貫く理を極めることを何というか。", answer: "格物致知" },
  { id: 166, category: "朱子学・陽明学", question: "朱子学における修養の方法で、欲望を抑えて身の振る舞いを厳粛にし、客観的な道徳理に従うことを何というか。", answer: "居敬窮理" },
  { id: 167, category: "朱子学・陽明学", question: "陽明学の祖、王陽明が説いた、生き生きと働く現実の心がそのまま理であるとする考えを何というか。", answer: "心即理" },
  { id: 168, category: "朱子学・陽明学", question: "王陽明が説いた、人間に先天的に備わっている善悪を判断する心の本体を何というか。", answer: "良知" },
  { id: 169, category: "朱子学・陽明学", question: "王陽明が説いた、知（認識）と行（実践）とは同じ心の作用の両面であり、本来一つのものであるという考えを何というか。", answer: "知行合一" },
  { id: 170, category: "日本儒教", question: "藤原惺窩が説いた、朱子学の学問体系を何というか。", answer: "京学" },
  { id: 171, category: "日本儒教", question: "林羅山が説いた、天地間の上下の秩序と同様に、人間社会にも上下の身分秩序があるとする理を何というか。", answer: "上下定分の理" },
  { id: 172, category: "日本儒教", question: "林羅山が説いた、心の中に敬を持ち続ける修養法を何というか。", answer: "存心持敬" },
  { id: 173, category: "日本儒教", question: "中江藤樹が説いた、人間愛の根本であり、すべての徳の基本となるものを何というか。", answer: "孝" },
  { id: 174, category: "日本儒教", question: "中江藤樹の主著で、対話形式で道徳を説いた書物は何か。", answer: "翁問答" },
  { id: 175, category: "日本儒教", question: "伊藤仁斎が提唱した、『論語』『孟子』の原典に立ち返り、その古義を明らかにしようとする学問を何というか。", answer: "古義学" },
  { id: 176, category: "日本儒教", question: "伊藤仁斎が孔子の教えの根本として重視した、万人に通じる愛の道を何というか。", answer: "仁愛" },
  { id: 177, category: "日本儒教", question: "荻生徂徠が提唱した、後世の解釈を排し、古代中国の先王の道を直接研究する学問を何というか。", answer: "古文辞学" },
  { id: 178, category: "日本儒教", question: "荻生徂徠が説いた、天下の万民を安んじるために人為的に制作した古代中国の聖人の道を何というか。", answer: "先王の道" },
  { id: 179, category: "日本儒教", question: "荻生徂徠が説いた、世を治め、民を救うことを目的とする政治論を何というか。", answer: "経世済民" },
  { id: 180, category: "国学", question: "本居宣長が確立した、仏教や儒教の影響を受ける以前の、日本固有の精神や文化を探求する学問を何というか。", answer: "国学" },
  { id: 181, category: "国学", question: "本居宣長が説いた、儒教や仏教など、中国の学問によって感化された心を何というか。", answer: "漢意" },
  { id: 182, category: "国学", question: "本居宣長が説いた、漢意を去り、日本の神代から伝わる純粋な心を何というか。", answer: "真心（大和魂）" },
  { id: 183, category: "国学", question: "本居宣長が説いた、人の心が外界の物事に触れて起こる、しみじみとした感動を何というか。", answer: "もののあはれ" },
  { id: 184, category: "国学", question: "本居宣長が説いた、仏の説を一切排し、日本固有の純粋な古代の神の道を説く神道を何というか。", answer: "復古神道" },
  { id: 185, category: "西洋近代思想", question: "ルネサンス期に見られた、ギリシア・ローマの古典に人間性の典型を求め、古典文学を学ぶことを通して人間性を回復しようとする考え方を何というか。", answer: "人文主義（ヒューマニズム）" },
  { id: 186, category: "西洋近代思想", question: "ピコ＝デラ＝ミランドラの著書で、人間の自由意志について論じたものは何か。", answer: "人間の尊厳について" },
  { id: 187, category: "西洋近代思想", question: "ルネサンス期の理想的人間像で、様々な分野で才能を発揮する人を何というか。", answer: "万能人" },
  { id: 188, category: "西洋近代思想", question: "ローマ＝カトリック教会が発行した、罪の許しが得られるとする証書を何というか。", answer: "免罪符（贖宥状）" },
  { id: 189, category: "西洋近代思想", question: "ルターが説いた、人間が義とされる（贖罪）は善行によってではなく、内面的な信仰のみによってであるという説を何というか。", answer: "信仰義認説" },
  { id: 190, category: "西洋近代思想", question: "ルターが説いた、信仰する者は誰でも司祭であり、僧俗の区別はないとする思想を何というか。", answer: "万人司祭主義" },
  { id: 191, category: "西洋近代思想", question: "ルターが説いた、あらゆる職業は神によって召されて与えられた使命（召命）であり、神の栄光の実現のために仕事に励むべきであるとする職業観を何というか。", answer: "職業召命観" },
  { id: 192, category: "西洋近代思想", question: "カルヴァンが説いた、人間が救われるか否かは神の意志によって定まっており、人間の善行にはよらないとする説を何というか。", answer: "予定説" },
  { id: 193, category: "科学革命", question: "ベーコンの有名な言葉で、経験に基づく知識は自然を支配する力になるという意味の言葉は何か。", answer: "知は力なり" },
  { id: 194, category: "科学革命", question: "ベーコンが指摘した、物事を正しく認識することを妨げる先入観や偏見を何というか。", answer: "イドラ" },
  { id: 195, category: "科学革命", question: "ベーコンが説いたイドラのうち、人間という種族に共通する偏見を何というか。", answer: "種族のイドラ" },
  { id: 196, category: "科学革命", question: "ベーコンが説いたイドラのうち、個人の個人的な性格・環境に由来する偏見を何というか。", answer: "洞窟のイドラ" },
  { id: 197, category: "科学革命", question: "ベーコンが説いたイドラのうち、言葉の不適切な使用によって生じる偏見を何というか。", answer: "市場のイドラ" },
  { id: 198, category: "科学革命", question: "ベーコンが説いたイドラのうち、伝統や権威を無批判に受け入れるところから生じる偏見を何というか。", answer: "劇場のイドラ" },
  { id: 199, category: "科学革命", question: "ベーコンが提唱した、数多くの観察や実験によって得られた個々の経験的事実から、それらに共通する一般的法則を求める方法を何というか。", answer: "帰納法" },
  { id: 200, category: "科学革命", question: "ベーコンに代表される、知識の源泉を感覚的経験に求める立場を何というか。", answer: "経験論" },
  { id: 201, category: "科学革命", question: "デカルトに代表される、確実な知識の源泉を理性に求める考え方を何というか。", answer: "合理論" },
  { id: 202, category: "科学革命", question: "デカルトが提唱した、普遍的原理から理性的な推理によって個別の真理や知識を導く方法を何というか。", answer: "演繹法" },
  { id: 203, category: "科学革命", question: "デカルトが行った、絶対に確実な真理を見つけるために、あらゆるものを疑っていく方法を何というか。", answer: "方法的懐疑" },
  { id: 204, category: "科学革命", question: "デカルトが到達した哲学の根本原理を示す言葉は何か。", answer: "われ思う、ゆえに我あり" },
  { id: 205, category: "科学革命", question: "デカルトが説いた、思惟するもの（精神）と延長するもの（物体）とはそれぞれ独立的に実在する実体であると考える立場を何というか。", answer: "物心二元論" },
  { id: 206, category: "科学革命", question: "デカルトが提唱した、あらゆる自然現象を物体の機械的な運動に還元して説明する自然観を何というか。", answer: "機械論的自然観" },
  { id: 207, category: "科学革命", question: "デカルトが示した、情念を理性によって統御する、気高い精神のあり方を何というか。", answer: "高邁の精神" },
  { id: 208, category: "社会契約説", question: "グロティウスが説いた、人間の理性に基づき、いついかなる時も守られるべき普遍的な法を何というか。", answer: "自然法" },
  { id: 209, category: "社会契約説", question: "ホッブズやロックが想定した、国家や社会が成立する以前の、法や道徳などの人為的抑制のない状態を何というか。", answer: "自然状態" },
  { id: 210, category: "社会契約説", question: "人間が生まれながらに持っている、生命・自由・財産などを守る権利を何というか。", answer: "自然権" },
  { id: 211, category: "社会契約説", question: "ホッブズが説いた、自然状態における、各人が自己保存の欲求を満たすために互いに争う状態を何というか。", answer: "万人の万人に対する闘争" },
  { id: 212, category: "社会契約説", question: "ホッブズの主著で、国家を巨大な怪物に例えた書名は何か。", answer: "リヴァイアサン" },
  { id: 213, category: "社会契約説", question: "ロックが説いた、政府が人民から信託された権力を濫用する場合に、政府に対して抵抗する権利を何というか。", answer: "抵抗権（革命権）" },
  { id: 214, category: "社会契約説", question: "ロックが説いた、人間の心は本来白紙（タブラ・ラサ）であり、知識は全て経験によって与えられるとする考え方を何というか。", answer: "白紙説" },
  { id: 215, category: "社会契約説", question: "ルソーが説いた、文明社会の堕落を批判し、自然状態を理想とする思想を表す標語は何か。", answer: "自然に帰れ" },
  { id: 216, category: "社会契約説", question: "ルソーが説いた、個人の私的な利益を求める意志を何というか。", answer: "特殊意志" },
  { id: 217, category: "社会契約説", question: "ルソーが説いた、個人の意志を超えて公共の利益だけを目指す普遍的な意志を何というか。", answer: "一般意志" },
  { id: 218, category: "社会契約説", question: "ルソーが理想とした、国民が政治に直接参加し、最終的な意志決定を行う制度を何というか。", answer: "直接民主制" },
  { id: 219, category: "ドイツ観念論", question: "カントが説いた、理性が自ら定めた道徳法則に自ら従うことを何というか。", answer: "自律" },
  { id: 220, category: "ドイツ観念論", question: "カントが説いた、自律的に行為する自由な道徳的主体としての人間のあり方を何というか。", answer: "人格" },
  { id: 221, category: "ドイツ観念論", question: "カントが説いた、条件つきの命令（〜ならば...せよ）ではなく、無条件の命令（...せよ）の形式をとる道徳法則を何というか。", answer: "定言命法" },
  { id: 222, category: "ドイツ観念論", question: "カントが提唱した、人間が相互に目的として尊敬し合う理想社会を何というか。", answer: "目的の国" },
  { id: 223, category: "ドイツ観念論", question: "ヘーゲル哲学において、歴史の主体となり、歴史を動かしている完全に自由な精神を何というか。", answer: "絶対精神" },
  { id: 224, category: "ドイツ観念論", question: "ヘーゲルが説いた、万物がそのうちに有している矛盾・対立を統一し、より高次のものへと至る運動・発展の論理を何というか。", answer: "弁証法" },
  { id: 225, category: "ドイツ観念論", question: "弁証法において、ある立場（正）とそれに対立する立場（反）を統合し、より高次の立場（合）へと高めることを何というか。", answer: "止揚（アウフヘーベン）" },
  { id: 226, category: "ドイツ観念論", question: "ヘーゲルが説いた、客観的・外面的な法と主観的・内面的な道徳性を統一したものを何というか。", answer: "人倫" },
  { id: 227, category: "ドイツ観念論", question: "ヘーゲルが説いた人倫の三段階のうち、家族から独立して自由で平等になった個人が、自己の欲望を満たすために利益を追求する経済社会を何というか。", answer: "市民社会" },
  { id: 228, category: "ドイツ観念論", question: "ヘーゲルが説いた、家族の全体性・普遍性と市民社会における個々の独立性・個別性を止揚した人倫の完成態を何というか。", answer: "国家" },
  { id: 229, category: "日本近代思想", question: "江戸時代、オランダ語を通じて西洋の学術・文化を学ぶ学問を何というか。", answer: "蘭学" },
  { id: 230, category: "日本近代思想", question: "佐久間象山が唱えた、東洋の道徳（魂）を基調としつつ、西洋の科学技術（才能）を活用しようとする態度を何というか。", answer: "和魂洋才" },
  { id: 231, category: "日本近代思想", question: "福沢諭吉らが結成した、西洋思想の啓蒙を目指す団体・結社を何というか。", answer: "明六社" },
  { id: 232, category: "日本近代思想", question: "福沢諭吉が説いた、人間の自由・平等といった権利は、生まれながらにして天から与えられたものであるという思想を何というか。", answer: "天賦人権論" },
  { id: 233, category: "日本近代思想", question: "福沢諭吉が説いた、個人がそれぞれ自主独立の生活を営もうとする精神を何というか。", answer: "独立自尊" },
  { id: 234, category: "日本近代思想", question: "福沢諭吉が奨励した、西洋学問にみられる合理的で日常生活に実際に役立つ学問を何というか。", answer: "実学" },
  { id: 235, category: "日本近代思想", question: "福沢諭吉が唱えた、アジア文明を野蛮とし、西欧的近代国家建設を目指すべきだとの考えを何というか。", answer: "脱亜論" },
  { id: 236, category: "日本近代思想", question: "中江兆民が紹介した、ルソーの『社会契約論』の翻訳書の題名は何か。", answer: "民約訳解" },
  { id: 237, category: "日本近代思想", question: "夏目漱石が説いた、伝統的な社会関係から解放され、自我の内面的要求に基づいて生きることを何というか。", answer: "自己本位" },
  { id: 238, category: "日本近代思想", question: "夏目漱石が晩年に到達した、小さな自我を去り、自然の理法に従って生きる境地を何というか。", answer: "則天去私" },
  { id: 239, category: "日本近代思想", question: "武者小路実篤・志賀直哉らが結成した、人道主義・理想主義的な文学派閥を何というか。", answer: "白樺派" },
  { id: 240, category: "日本近代思想", question: "徳富蘇峰が唱えた、一般民衆の立場に立つ政治的主張を何というか。", answer: "平民主義" },
  { id: 241, category: "日本近代思想", question: "三宅雪嶺らが唱えた、日本の伝統・文化を維持しようとする思想を何というか。", answer: "国粋主義" },
  { id: 242, category: "日本近代思想", question: "内村鑑三が不敬事件を起こすきっかけとなった、教育に関する勅語を何というか。", answer: "教育勅語" },
  { id: 243, category: "日本近代思想", question: "内村鑑三が唱えた、教会という制度によらず、聖書のみに基づいて信仰する立場を何というか。", answer: "無教会主義" },
  { id: 244, category: "日本近代思想", question: "幸徳秋水らが処刑された、天皇暗殺を計画したとされる事件を何というか。", answer: "大逆事件" },
  { id: 245, category: "日本近代思想", question: "吉野作造が唱えた、主権の所在を問わず、政治の目的を民衆の利福に置き、民衆の意向を政治決定の基礎とする考えを何というか。", answer: "民本主義" },
  { id: 246, category: "日本近代思想", question: "全国水平社が結成され、差別の撤廃と人権の確立を目指した運動を何というか。", answer: "部落解放運動" },
  { id: 247, category: "日本近代思想", question: "平塚らいてうらが雑誌『青鞜』を発刊して展開した、女性の権利獲得を目指す運動を何というか。", answer: "女性解放運動" },
  { id: 248, category: "日本独自の哲学", question: "西田幾多郎の主著で、日本独自の哲学体系を打ち立てた書物は何か。", answer: "善の研究" },
  { id: 249, category: "日本独自の哲学", question: "西田幾多郎が説いた、主観と客観とがまだ区別されていない、知的な分別を加える以前の直接的な経験を何というか。", answer: "純粋経験" },
  { id: 250, category: "日本独自の哲学", question: "西田幾多郎が説いた、主観と客観が未だ分かれていない状態を何というか。", answer: "主客未分" },
  { id: 251, category: "日本独自の哲学", question: "和辻哲郎が説いた、人間は決して孤立した個人的な存在ではなく、常に人と人との関係においてのみ人間たりうるということを示す概念は何か。", answer: "間柄的存在" },
  { id: 252, category: "日本独自の哲学", question: "柳田国男が研究対象とした、古くからある共同体の中に生きる普通の人々を何というか。", answer: "常民" },
  { id: 253, category: "日本独自の哲学", question: "柳田国男が創始した、民衆の生活に密着した伝統文化や伝承を探求する学問を何というか。", answer: "民俗学" },
];

// --- ユーティリティ関数 ---
const shuffleArray = <T,>(array: T[]): T[] => {
  const newArray = [...array];
  for (let i = newArray.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
  }
  return newArray;
};

const historyCategoryOrder = [
  "ナチスの台頭", "ナチスの内政", "ドイツ情勢", "ヒトラーの経歴", "ヒトラーの拡張",
  "満州事変", "日中戦争前夜", "日中戦争", "戦時体制",
  "第二次世界大戦", "欧州戦線の終結", "独ソ戦",
  "太平洋戦争", "太平洋戦争（地図・まとめ）",
  "戦時下の日本", "敗戦への道", "戦争の被害・戦後",
  "冷戦の終結", "戦後の欧州", "戦後のアメリカ", "戦後の日本"
];

const ethicsCategoryOrder = [
  "人間とは", "古代ギリシア", "ソフィスト・ソクラテス", "プラトン", "アリストテレス",
  "ユダヤ教", "キリスト教", "イスラーム教", "インド思想", "仏教", "日本仏教",
  "中国思想", "朱子学・陽明学", "日本儒教", "国学",
  "西洋近代思想", "科学革命", "社会契約説", "ドイツ観念論",
  "日本近代思想", "日本独自の哲学"
];

const getUniqueCategories = (data: typeof historyData, subject: Subject) => {
  const order = subject === 'history' ? historyCategoryOrder : ethicsCategoryOrder;
  const uniqueCats = Array.from(new Set(data.map(item => item.category)));
  return uniqueCats.sort((a, b) => {
    const indexA = order.indexOf(a);
    const indexB = order.indexOf(b);
    if (indexA !== -1 && indexB !== -1) return indexA - indexB;
    if (indexA !== -1) return -1;
    if (indexB !== -1) return 1;
    return 0;
  });
};

const getStorageKey = (subject: Subject, type: 'mastered' | 'failed') => `kioku-${subject}-${type}-ids`;
const SUBJECT_STORAGE_KEY = 'kioku-selected-subject';

const loadIds = (subject: Subject, type: 'mastered' | 'failed'): number[] => {
  try {
    const saved = localStorage.getItem(getStorageKey(subject, type));
    if (saved) return JSON.parse(saved);
  } catch (e) {
    console.error('Failed to load saved progress', e);
  }
  return [];
};

const loadSelectedSubject = (): Subject | null => {
  try {
    const saved = localStorage.getItem(SUBJECT_STORAGE_KEY);
    if (saved === 'history' || saved === 'ethics') return saved;
  } catch (e) {
    console.error('Failed to load selected subject', e);
  }
  return null;
};

type StatusFilter = 'all' | 'unseen' | 'failed' | 'learned';

// --- 教科選択画面 ---
function SubjectSelector({ onSelect }: { onSelect: (subject: Subject) => void }) {
  return (
    <div className="min-h-screen bg-zinc-900 flex items-center justify-center p-4">
      <div className="max-w-md w-full">
        <div className="text-center mb-8">
          <div className="w-16 h-16 bg-indigo-500 rounded-2xl flex items-center justify-center mx-auto mb-4">
            <BookOpen className="w-8 h-8 text-white" />
          </div>
          <h1 className="text-2xl font-bold text-white mb-2">Kioku</h1>
          <p className="text-zinc-400 text-sm">学習する教科を選択してください</p>
        </div>

        <div className="space-y-3">
          <button
            onClick={() => onSelect('history')}
            className="w-full p-5 bg-zinc-800 rounded-xl border border-zinc-700 hover:border-amber-500/50 hover:bg-zinc-800/80 transition-all group"
          >
            <div className="flex items-center gap-4">
              <div className="w-12 h-12 bg-amber-500/20 rounded-xl flex items-center justify-center group-hover:bg-amber-500/30 transition-colors">
                <History className="w-6 h-6 text-amber-400" />
              </div>
              <div className="text-left">
                <h2 className="text-lg font-semibold text-white">歴史</h2>
                <p className="text-sm text-zinc-400">{historyData.length} 問</p>
              </div>
            </div>
          </button>

          <button
            onClick={() => onSelect('ethics')}
            className="w-full p-5 bg-zinc-800 rounded-xl border border-zinc-700 hover:border-purple-500/50 hover:bg-zinc-800/80 transition-all group"
          >
            <div className="flex items-center gap-4">
              <div className="w-12 h-12 bg-purple-500/20 rounded-xl flex items-center justify-center group-hover:bg-purple-500/30 transition-colors">
                <Brain className="w-6 h-6 text-purple-400" />
              </div>
              <div className="text-left">
                <h2 className="text-lg font-semibold text-white">倫理</h2>
                <p className="text-sm text-zinc-400">{ethicsData.length} 問</p>
              </div>
            </div>
          </button>
        </div>
      </div>
    </div>
  );
}

export default function KiokuApp() {
  const initialSubject = loadSelectedSubject();
  const [selectedSubject, setSelectedSubject] = useState<Subject | null>(initialSubject);
  const [questions, setQuestions] = useState(() =>
    initialSubject === 'history' ? historyData : initialSubject === 'ethics' ? ethicsData : historyData
  );
  const [currentIndex, setCurrentIndex] = useState(0);
  const [isFlipped, setIsFlipped] = useState(false);
  const [masteredIds, setMasteredIds] = useState<number[]>(() =>
    initialSubject ? loadIds(initialSubject, 'mastered') : []
  );
  const [failedIds, setFailedIds] = useState<number[]>(() =>
    initialSubject ? loadIds(initialSubject, 'failed') : []
  );
  const [filterCategory, setFilterCategory] = useState<string>('All');
  const [showList, setShowList] = useState(false);
  const [statusFilter, setStatusFilter] = useState<StatusFilter>('all');
  const [touchStart, setTouchStart] = useState<number | null>(null);
  const [swipeOffset, setSwipeOffset] = useState(0);
  const [isInitialized, setIsInitialized] = useState(!!initialSubject);

  const rawData = selectedSubject === 'history' ? historyData : ethicsData;

  // 教科変更時にデータを更新
  useEffect(() => {
    if (selectedSubject && !isInitialized) {
      // 新しく教科が選ばれた場合
      const newData = selectedSubject === 'history' ? historyData : ethicsData;
      setQuestions(newData);
      setMasteredIds(loadIds(selectedSubject, 'mastered'));
      setFailedIds(loadIds(selectedSubject, 'failed'));
      setCurrentIndex(0);
      setFilterCategory('All');
      setStatusFilter('all');
      setIsFlipped(false);
      localStorage.setItem(SUBJECT_STORAGE_KEY, selectedSubject);
      setIsInitialized(true);
    }
  }, [selectedSubject, isInitialized]);

  // 教科切り替え時のリセット
  const handleChangeSubjectInternal = () => {
    setSelectedSubject(null);
    setIsInitialized(false);
    localStorage.removeItem(SUBJECT_STORAGE_KEY);
  };

  useEffect(() => {
    if (selectedSubject && isInitialized) {
      localStorage.setItem(getStorageKey(selectedSubject, 'mastered'), JSON.stringify(masteredIds));
    }
  }, [masteredIds, selectedSubject, isInitialized]);

  useEffect(() => {
    if (selectedSubject && isInitialized) {
      localStorage.setItem(getStorageKey(selectedSubject, 'failed'), JSON.stringify(failedIds));
    }
  }, [failedIds, selectedSubject, isInitialized]);

  const filteredQuestions = useMemo(() => {
    let filtered = questions;
    if (filterCategory !== 'All') {
      filtered = filtered.filter(q => q.category === filterCategory);
    }
    if (statusFilter === 'unseen') {
      // 未学習: まだ見ていない問題
      filtered = filtered.filter(q => !masteredIds.includes(q.id) && !failedIds.includes(q.id));
    } else if (statusFilter === 'failed') {
      // わからなかった問題
      filtered = filtered.filter(q => failedIds.includes(q.id));
    } else if (statusFilter === 'learned') {
      // 習得済み
      filtered = filtered.filter(q => masteredIds.includes(q.id));
    }
    return filtered;
  }, [questions, filterCategory, statusFilter, masteredIds, failedIds]);

  // currentIndexが範囲外になったら調整
  useEffect(() => {
    if (filteredQuestions.length > 0 && currentIndex >= filteredQuestions.length) {
      setCurrentIndex(0);
    }
  }, [filteredQuestions.length, currentIndex]);

  const handleSelectSubject = (subject: Subject) => {
    setSelectedSubject(subject);
  };

  const handleChangeSubject = handleChangeSubjectInternal;

  // 教科選択画面を表示
  if (!selectedSubject) {
    return <SubjectSelector onSelect={handleSelectSubject} />;
  }

  const currentQuestion = filteredQuestions[currentIndex];
  const progressPercentage = Math.round((masteredIds.length / rawData.length) * 100);
  const unseenCount = rawData.length - masteredIds.length - failedIds.length;
  const failedCount = failedIds.length;
  const learnedCount = masteredIds.length;

  const handleNext = () => {
    if (filteredQuestions.length === 0) return;
    setIsFlipped(false);
    setTimeout(() => {
      setCurrentIndex((prev) => (prev + 1) % filteredQuestions.length);
    }, 150);
  };

  const handlePrev = () => {
    if (filteredQuestions.length === 0) return;
    setIsFlipped(false);
    setTimeout(() => {
      setCurrentIndex((prev) => (prev - 1 + filteredQuestions.length) % filteredQuestions.length);
    }, 150);
  };

  // 一覧用: ステータスを循環切り替え (未学習 → わからない → 習得済み → 未学習)
  const cycleStatus = (id: number) => {
    const isMastered = masteredIds.includes(id);
    const isFailed = failedIds.includes(id);

    if (isMastered) {
      // 習得済み → 未学習
      setMasteredIds(prev => prev.filter(mid => mid !== id));
    } else if (isFailed) {
      // わからない → 習得済み
      setFailedIds(prev => prev.filter(fid => fid !== id));
      setMasteredIds(prev => [...prev, id]);
    } else {
      // 未学習 → わからない
      setFailedIds(prev => [...prev, id]);
    }
  };

  const markAsLearned = () => {
    if (!currentQuestion) return;

    const doMark = () => {
      // 習得済みに追加、わからないから削除
      if (!masteredIds.includes(currentQuestion.id)) {
        setMasteredIds(prev => [...prev, currentQuestion.id]);
      }
      setFailedIds(prev => prev.filter(fid => fid !== currentQuestion.id));
      handleNext();
    };

    // 答えが表示されていない場合、先に表示してから次へ
    if (!isFlipped) {
      setIsFlipped(true);
      setTimeout(doMark, 600);
    } else {
      doMark();
    }
  };

  const markAsFailed = () => {
    if (!currentQuestion) return;

    const doMark = () => {
      // わからないに追加、習得済みから削除
      if (!failedIds.includes(currentQuestion.id)) {
        setFailedIds(prev => [...prev, currentQuestion.id]);
      }
      setMasteredIds(prev => prev.filter(mid => mid !== currentQuestion.id));
      handleNext();
    };

    // 答えが表示されていない場合、先に表示してから次へ
    if (!isFlipped) {
      setIsFlipped(true);
      setTimeout(doMark, 600);
    } else {
      doMark();
    }
  };

  const handleTouchStart = (e: React.TouchEvent) => {
    const touchX = e.touches[0].clientX;
    const screenWidth = window.innerWidth;
    // 画面端50px以内からのスワイプはブラウザジェスチャー用に無視
    if (touchX < 50 || touchX > screenWidth - 50) {
      setTouchStart(null);
      return;
    }
    setTouchStart(touchX);
  };

  const handleTouchMove = (e: React.TouchEvent) => {
    if (touchStart === null) return;
    const diff = e.touches[0].clientX - touchStart;
    // 水平方向に動き始めたらブラウザのデフォルト動作を防ぐ
    if (Math.abs(diff) > 10) {
      e.preventDefault();
    }
    setSwipeOffset(Math.max(-100, Math.min(100, diff)));
  };

  const handleTouchEnd = () => {
    if (touchStart !== null && Math.abs(swipeOffset) > 60) {
      if (swipeOffset > 0) {
        markAsLearned();
      } else {
        markAsFailed();
      }
    }
    setTouchStart(null);
    setSwipeOffset(0);
  };

  const handleCategoryChange = (cat: string) => {
    setFilterCategory(cat);
    setCurrentIndex(0);
    setIsFlipped(false);
    setShowList(false);
  };

  const shuffleQuestions = () => {
    setQuestions(shuffleArray([...questions]));
    setCurrentIndex(0);
    setIsFlipped(false);
  };

  // 完了画面（問題がない場合）
  if (filteredQuestions.length === 0 || !currentQuestion) {
    const getMessage = () => {
      switch (statusFilter) {
        case 'unseen': return { title: 'Complete!', desc: '全ての問題を学習しました！' };
        case 'failed': return { title: 'Great!', desc: '復習問題を全てクリアしました！' };
        case 'learned': return { title: 'No Questions', desc: '習得済みの問題はまだありません。' };
        default: return { title: 'No Questions', desc: 'このカテゴリの問題はありません。' };
      }
    };
    const msg = getMessage();
    return (
      <div className="min-h-screen bg-zinc-900 flex items-center justify-center p-4">
        <div className="text-center p-6 bg-zinc-800 rounded-xl border border-zinc-700 max-w-sm w-full">
          <div className={`w-14 h-14 rounded-full flex items-center justify-center mx-auto mb-4 ${
            selectedSubject === 'history' ? 'bg-amber-500' : 'bg-purple-500'
          }`}>
            <Trophy className="w-7 h-7 text-white" />
          </div>
          <h2 className="text-xl font-bold text-white mb-2">{msg.title}</h2>
          <p className="text-sm text-zinc-400 mb-5">{msg.desc}
          </p>
          <div className="flex gap-2 justify-center">
            <button
              onClick={() => { setFilterCategory('All'); setStatusFilter('all'); }}
              className="px-5 py-2 bg-zinc-700 text-white rounded-lg text-sm font-medium hover:bg-zinc-600 transition-colors"
            >
              全問題に戻る
            </button>
            <button
              onClick={handleChangeSubject}
              className="px-5 py-2 bg-zinc-700 text-white rounded-lg text-sm font-medium hover:bg-zinc-600 transition-colors"
            >
              教科変更
            </button>
          </div>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-zinc-900">
      {/* ヘッダー */}
      <header className="bg-zinc-800/80 backdrop-blur border-b border-zinc-700/50 sticky top-0 z-50">
        <div className="max-w-5xl mx-auto px-3 py-2">
          <div className="flex justify-between items-center">
            <div className="flex items-center gap-2">
              <button
                onClick={handleChangeSubject}
                className="w-7 h-7 bg-zinc-700 rounded-lg flex items-center justify-center hover:bg-zinc-600 transition-colors"
                title="教科を変更"
              >
                <ArrowLeft className="w-4 h-4 text-zinc-300" />
              </button>
              <div className={`w-7 h-7 rounded-lg flex items-center justify-center ${selectedSubject === 'history' ? 'bg-amber-500' : 'bg-purple-500'}`}>
                {selectedSubject === 'history' ? (
                  <History className="w-4 h-4 text-white" />
                ) : (
                  <Brain className="w-4 h-4 text-white" />
                )}
              </div>
              <h1 className="font-semibold text-sm text-white">
                {selectedSubject === 'history' ? '歴史' : '倫理'}
              </h1>
            </div>

            {/* 進捗 */}
            <div className="flex items-center gap-2">
              <span className="text-xs text-zinc-400 hidden sm:inline">{masteredIds.length}/{rawData.length}</span>
              <div className="w-20 h-1.5 bg-zinc-700 rounded-full overflow-hidden">
                <div
                  className={`h-full transition-all duration-300 ${selectedSubject === 'history' ? 'bg-amber-500' : 'bg-purple-500'}`}
                  style={{ width: `${progressPercentage}%` }}
                />
              </div>
              <span className="text-xs font-medium text-zinc-300">{progressPercentage}%</span>
            </div>
          </div>
        </div>
      </header>

      {/* コントロールバー */}
      <div className="bg-zinc-800/50 border-b border-zinc-700/30">
        <div className="max-w-5xl mx-auto px-3 py-1.5">
          <div className="flex flex-wrap gap-1.5 items-center">
            {/* モード切替 */}
            <div className="flex bg-zinc-700/50 rounded-lg p-0.5">
              <button
                onClick={() => setShowList(false)}
                className={`flex items-center gap-1 px-2.5 py-1 rounded-md text-xs font-medium transition-colors ${!showList ? 'bg-zinc-600 text-white' : 'text-zinc-400 hover:text-white'}`}
              >
                <Layers size={12} />
                <span className="hidden sm:inline">カード</span>
              </button>
              <button
                onClick={() => setShowList(true)}
                className={`flex items-center gap-1 px-2.5 py-1 rounded-md text-xs font-medium transition-colors ${showList ? 'bg-zinc-600 text-white' : 'text-zinc-400 hover:text-white'}`}
              >
                <List size={12} />
                <span className="hidden sm:inline">一覧</span>
              </button>
            </div>

            {/* 状態フィルター */}
            <div className="flex bg-zinc-700/50 rounded-lg p-0.5">
              <button
                onClick={() => { setStatusFilter('all'); setCurrentIndex(0); setIsFlipped(false); }}
                className={`px-2 py-1 rounded-md text-xs font-medium transition-colors ${statusFilter === 'all' ? 'bg-zinc-600 text-white' : 'text-zinc-400 hover:text-white'}`}
              >
                全て
              </button>
              <button
                onClick={() => { setStatusFilter('unseen'); setCurrentIndex(0); setIsFlipped(false); }}
                className={`px-2 py-1 rounded-md text-xs font-medium transition-colors ${statusFilter === 'unseen' ? 'bg-zinc-500 text-white' : 'text-zinc-400 hover:text-white'}`}
              >
                未学習 ({unseenCount})
              </button>
              <button
                onClick={() => { setStatusFilter('failed'); setCurrentIndex(0); setIsFlipped(false); }}
                className={`px-2 py-1 rounded-md text-xs font-medium transition-colors ${statusFilter === 'failed' ? 'bg-rose-500 text-white' : 'text-zinc-400 hover:text-white'}`}
              >
                復習 ({failedCount})
              </button>
              <button
                onClick={() => { setStatusFilter('learned'); setCurrentIndex(0); setIsFlipped(false); }}
                className={`px-2 py-1 rounded-md text-xs font-medium transition-colors ${statusFilter === 'learned' ? 'bg-emerald-500 text-white' : 'text-zinc-400 hover:text-white'}`}
              >
                習得 ({learnedCount})
              </button>
            </div>

            <button
              onClick={shuffleQuestions}
              className="flex items-center gap-1 px-2.5 py-1 rounded-lg bg-zinc-700/50 text-zinc-400 text-xs font-medium hover:bg-zinc-700 hover:text-white transition-colors"
            >
              <RotateCcw size={12} />
              <span className="hidden sm:inline">シャッフル</span>
            </button>

            <button
              onClick={() => { if (confirm('学習記録をリセットしますか？')) { setMasteredIds([]); setFailedIds([]); } }}
              className="flex items-center gap-1 px-2.5 py-1 rounded-lg bg-zinc-700/50 text-zinc-400 text-xs font-medium hover:bg-red-500/20 hover:text-red-400 transition-colors"
            >
              <RefreshCw size={12} />
            </button>

            <select
              value={filterCategory}
              onChange={(e) => handleCategoryChange(e.target.value)}
              className={`ml-auto px-2.5 py-1 rounded-lg bg-zinc-700/50 text-zinc-300 text-xs font-medium border-none outline-none focus:ring-1 cursor-pointer ${selectedSubject === 'history' ? 'focus:ring-amber-500' : 'focus:ring-purple-500'}`}
            >
              <option value="All" className="bg-zinc-800">全範囲 ({rawData.length})</option>
              {getUniqueCategories(rawData, selectedSubject).map(cat => (
                <option key={cat} value={cat} className="bg-zinc-800">{cat}</option>
              ))}
            </select>
          </div>
        </div>
      </div>

      {/* メインエリア */}
      <main className="max-w-5xl mx-auto px-3 py-4">
        {showList ? (
          <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-2.5">
            {filteredQuestions.map((q) => {
              const isMastered = masteredIds.includes(q.id);
              const isFailed = failedIds.includes(q.id);
              return (
                <div
                  key={q.id}
                  className={`bg-zinc-800 rounded-lg p-3 border transition-colors ${
                    isMastered
                      ? 'border-emerald-500/40'
                      : isFailed
                        ? 'border-rose-500/40'
                        : 'border-zinc-700/50 hover:border-zinc-600'
                  }`}
                >
                  <div className="flex justify-between items-start mb-2">
                    <span className="text-[10px] font-medium text-zinc-500 bg-zinc-700/50 px-1.5 py-0.5 rounded">
                      {q.category}
                    </span>
                    <button onClick={() => cycleStatus(q.id)} className="p-0.5" title="クリックでステータス変更">
                      {isMastered ? (
                        <CheckCircle className="w-4 h-4 text-emerald-400" />
                      ) : isFailed ? (
                        <XCircle className="w-4 h-4 text-rose-400" />
                      ) : (
                        <Circle className="w-4 h-4 text-zinc-600" />
                      )}
                    </button>
                  </div>
                  <p className="text-xs text-zinc-300 mb-2.5 leading-relaxed">{q.question}</p>
                  <div className={`px-2.5 py-1.5 rounded border ${
                    isMastered
                      ? 'bg-emerald-500/10 border-emerald-500/20'
                      : isFailed
                        ? 'bg-rose-500/10 border-rose-500/20'
                        : 'bg-zinc-700/30 border-zinc-600/30'
                  }`}>
                    <span className={`font-medium text-xs ${
                      isMastered ? 'text-emerald-300' : isFailed ? 'text-rose-300' : 'text-zinc-300'
                    }`}>{q.answer}</span>
                  </div>
                </div>
              );
            })}
          </div>
        ) : (
          <div className="flex flex-col items-center pt-4 md:pt-8">
            <span className="text-zinc-500 text-[10px] font-medium tracking-wider mb-3">
              {currentIndex + 1} / {filteredQuestions.length}
            </span>

            {/* スワイプヒント */}
            <div className="flex justify-between w-full max-w-lg px-2 mb-2">
              <span className={`text-[10px] transition-opacity ${swipeOffset < -20 ? 'text-rose-400 opacity-100' : 'text-zinc-600 opacity-50'}`}>← わからない</span>
              <span className={`text-[10px] transition-opacity ${swipeOffset > 20 ? 'text-emerald-400 opacity-100' : 'text-zinc-600 opacity-50'}`}>わかった →</span>
            </div>

            <div
              className="w-full max-w-lg cursor-pointer select-none"
              onClick={() => setIsFlipped(!isFlipped)}
              onTouchStart={handleTouchStart}
              onTouchMove={handleTouchMove}
              onTouchEnd={handleTouchEnd}
              style={{
                transform: `translateX(${swipeOffset}px) rotate(${swipeOffset * 0.05}deg)`,
                transition: touchStart ? 'none' : 'transform 0.2s ease-out',
                touchAction: 'pan-y'
              }}
            >
              <div className={`bg-zinc-800 rounded-xl border overflow-hidden transition-colors ${
                swipeOffset > 30 ? 'border-emerald-500/50' : swipeOffset < -30 ? 'border-amber-500/50' : 'border-zinc-700/50'
              }`}>
                <div className="px-4 py-2.5 border-b border-zinc-700/50 flex justify-between items-center">
                  <span className="flex items-center gap-1.5 text-[10px] font-medium text-zinc-500">
                    {currentQuestion.category.includes('地図') && <MapPin size={10} className="text-rose-400" />}
                    {currentQuestion.category.includes('世界') && <Globe size={10} className="text-sky-400" />}
                    {currentQuestion.category}
                  </span>
                  {masteredIds.includes(currentQuestion.id) ? (
                    <span className="flex items-center gap-1 text-[10px] font-medium text-emerald-400">
                      <CheckCircle size={10} /> 習得済み
                    </span>
                  ) : failedIds.includes(currentQuestion.id) ? (
                    <span className="flex items-center gap-1 text-[10px] font-medium text-rose-400">
                      <XCircle size={10} /> 復習
                    </span>
                  ) : null}
                </div>

                <div className="p-5 min-h-[180px] flex flex-col justify-center">
                  <p className="text-sm md:text-base text-zinc-200 text-center leading-relaxed">
                    {currentQuestion.question.split('（　？　）').map((part, i, arr) => (
                      <React.Fragment key={i}>
                        {part}
                        {i < arr.length - 1 && (
                          <span className={`inline-block mx-0.5 px-2 py-0.5 rounded font-semibold transition-all ${isFlipped
                            ? 'text-indigo-300 bg-indigo-500/20'
                            : 'text-transparent bg-zinc-700 min-w-[3em]'
                            }`}>
                            {isFlipped ? currentQuestion.answer : '???'}
                          </span>
                        )}
                      </React.Fragment>
                    ))}
                  </p>

                  {!currentQuestion.question.includes('（　？　）') && (
                    <div className={`mt-4 w-full p-3 rounded-lg text-center transition-all ${isFlipped ? 'bg-indigo-500/10 border border-indigo-500/20' : 'bg-zinc-700/30'
                      }`}>
                      <span className="text-[10px] text-zinc-500 block mb-1">
                        {isFlipped ? 'ANSWER' : 'TAP TO REVEAL'}
                      </span>
                      <span className={`text-base md:text-lg font-semibold ${isFlipped ? 'text-indigo-300' : 'text-transparent'}`}>
                        {currentQuestion.answer}
                      </span>
                    </div>
                  )}

                  {!isFlipped && (
                    <p className="text-center text-zinc-600 text-[10px] mt-3">タップして答えを表示</p>
                  )}
                </div>
              </div>
            </div>

            {/* アクションボタン - 常に表示 */}
            <div className="flex gap-3 mt-4 w-full max-w-lg">
              <button
                onClick={markAsFailed}
                className="flex-1 flex items-center justify-center gap-1.5 px-4 py-2.5 rounded-lg bg-zinc-800 border border-zinc-700 text-rose-400 text-xs font-medium hover:bg-zinc-700 transition-colors"
              >
                <ChevronLeft size={14} />
                わからない
              </button>
              <button
                onClick={markAsLearned}
                className="flex-1 flex items-center justify-center gap-1.5 px-4 py-2.5 rounded-lg bg-emerald-600 text-white text-xs font-medium hover:bg-emerald-500 transition-colors"
              >
                わかった
                <ChevronRight size={14} />
              </button>
            </div>

            <div className="flex items-center gap-4 mt-5">
              <button
                onClick={handlePrev}
                className="p-2 rounded-lg bg-zinc-800 text-zinc-400 hover:text-white hover:bg-zinc-700 transition-colors"
              >
                <ChevronLeft size={18} />
              </button>

              <div className="flex gap-1">
                {Array.from({ length: Math.min(5, filteredQuestions.length) }, (_, i) => {
                  const startIdx = Math.max(0, Math.min(currentIndex - 2, filteredQuestions.length - 5));
                  const idx = startIdx + i;
                  return (
                    <div
                      key={idx}
                      className={`h-1 rounded-full transition-all ${idx === currentIndex
                        ? (selectedSubject === 'history' ? 'bg-amber-400 w-4' : 'bg-purple-400 w-4')
                        : 'bg-zinc-700 w-1'
                      }`}
                    />
                  );
                })}
              </div>

              <button
                onClick={handleNext}
                className={`p-2 rounded-lg text-white transition-colors ${
                  selectedSubject === 'history' ? 'bg-amber-500 hover:bg-amber-600' : 'bg-purple-500 hover:bg-purple-600'
                }`}
              >
                <ChevronRight size={18} />
              </button>
            </div>
          </div>
        )}
      </main>
    </div>
  );
}
